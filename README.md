# OpenClaw Token Tracker

Track and analyze token usage across OpenClaw sessions with accurate pricing, dynamic model detection, and persistent historical data.

**Key Features:**
- üìä Daily/Weekly/Monthly token usage breakdown
- ü§ñ Dynamic model detection (Haiku, Sonnet, Opus)
- üí∞ Accurate pricing per model
- üìÅ Persistent historical snapshots (never lose data)
- ‚ö° 100% LLM-free (pure bash + cron)
- 0Ô∏è‚É£ Zero token cost

## Installation

1. Copy scripts to your workspace:
```bash
cp daily-token-counter.sh token-history-logger.sh /home/openclaw/.openclaw/workspace/
chmod +x /home/openclaw/.openclaw/workspace/*.sh
```

2. Create history directory:
```bash
mkdir -p /home/openclaw/.openclaw/workspace/token-history
```

3. Add cron jobs (optional, for automatic daily snapshots):
```bash
# Add to crontab for daily 23:55 UTC snapshot
55 23 * * * /home/openclaw/.openclaw/workspace/token-history-logger.sh >/dev/null 2>&1

# Or use Telegram bot command (see below)
```

## Usage

### Manual Check
```bash
/home/openclaw/.openclaw/workspace/daily-token-counter.sh
```

### Telegram Bot Command
Set up `/tokens` command in your OpenClaw bot to get instant reports:
```
/tokens
```

### Output Example
```
üìä Token Usage Breakdown
ü§ñ Model: Claude Haiku 4.5 ($0.80/M in, $4.00/M out)

  TODAY (live):
    Input:          23 | Output:        508 | Total:        531 | Cost: $0.0021

  WEEKLY (last 7 days):
    Input:          22 | Output:        593 | Total:        615 | Cost: $0.0024

  MONTHLY (last 30 days):
    Input:          22 | Output:        593 | Total:        615 | Cost: $0.0024

üìÅ History stored in: /home/openclaw/.openclaw/workspace/token-history
Generated by bash (0 tokens)
```

## Scripts

### `daily-token-counter.sh`
Main token counter. Reports current usage across all sessions with daily/weekly/monthly breakdowns.

**Features:**
- Reads live session data from `openclaw sessions list`
- Aggregates historical data from daily snapshots
- Auto-detects active model and applies correct pricing
- Shows input/output tokens separately
- Calculates costs based on Anthropic's pricing

**Supported Models:**
- Claude Haiku 4.5 ($0.80/M input, $4.00/M output)
- Claude Sonnet 4.0 ($3.00/M input, $15.00/M output)
- Claude Opus 4.1 ($15.00/M input, $75.00/M output)

### `token-history-logger.sh`
Daily snapshot logger. Run once per day (via cron) to capture end-of-day token usage.

**What it does:**
- Captures current session totals
- Records model in use
- Saves JSON snapshot to `token-history/{DATE}.json`
- Enables accurate historical trending

**Sample Output:**
```json
{
  "timestamp": "2026-02-06T23:55:00Z",
  "date": "2026-02-06",
  "model": "claude-haiku-4-5",
  "inputTokens": 22,
  "outputTokens": 593,
  "totalTokens": 615,
  "sessions": [...]
}
```

## Architecture

### Data Flow
```
OpenClaw Sessions
    ‚Üì
Live Counter (daily-token-counter.sh)
    ‚Üì
History Logger (daily snapshot @ 23:55 UTC)
    ‚Üì
token-history/{DATE}.json files
    ‚Üì
Weekly/Monthly Aggregator (reads history)
```

### Why LLM-Free?
- **Session tracking**: Built into OpenClaw (no Claude needed)
- **Token counting**: Pure arithmetic on session metadata
- **History storage**: Plain JSON files + bash + cron
- **Aggregation**: `jq` queries, no LLM inference

**Result:** Costs $0/month to track and $0.0015-0.003/day to use the bot.

## Pricing Accuracy

Prices are pulled from Anthropic's official rates (as of Feb 2026):

**Official Source:** https://www.anthropic.com/pricing

**Haiku 4.5:**
- Input: $0.80 per 1M tokens
- Output: $4.00 per 1M tokens

**Sonnet 4.0:**
- Input: $3.00 per 1M tokens
- Output: $15.00 per 1M tokens

**Opus 4.1:**
- Input: $15.00 per 1M tokens
- Output: $75.00 per 1M tokens

The script automatically calculates costs based on the primary model detected in your sessions.

‚ö†Ô∏è **Note:** Pricing may change. Always verify against https://www.anthropic.com/pricing for the latest rates. To update pricing in the script, edit the `get_model_pricing()` function in `daily-token-counter.sh`.

## File Structure

```
openclaw-token-tracker/
‚îú‚îÄ‚îÄ README.md                      # This file
‚îú‚îÄ‚îÄ daily-token-counter.sh         # Main counter script
‚îú‚îÄ‚îÄ token-history-logger.sh        # History snapshot logger
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ SETUP.md                   # Installation guide
    ‚îú‚îÄ‚îÄ ARCHITECTURE.md            # Technical details
    ‚îî‚îÄ‚îÄ PRICING.md                 # Pricing reference
```

## Telegram Bot Integration

To use `/tokens` in Telegram:

1. Add the command to BotFather:
   ```
   /editcommands
   tokens - Daily token usage and cost
   ```

2. When users call `/tokens`, the bot runs:
   ```bash
   /home/openclaw/.openclaw/workspace/daily-token-counter.sh
   ```

3. Output is sent directly to Telegram

## Cron Scheduling

### Daily Snapshot (Recommended)
```bash
55 23 * * * /home/openclaw/.openclaw/workspace/token-history-logger.sh >/dev/null 2>&1
```
Runs 5 minutes before midnight UTC. Captures end-of-day totals.

### Via OpenClaw Gateway
```bash
openclaw cron add --name healthcheck:daily-token-snapshot --schedule "cron:0 0 * * * UTC" --payload 'systemEvent:Run token snapshot' 
```

## Troubleshooting

### No Historical Data
History only builds as you use the system. First reports will be today's data repeated for weekly/monthly until past data accumulates.

### Wrong Model Detected
Make sure your OpenClaw config has the correct primary model set:
```bash
openclaw status | grep Model
```

### Permission Denied
```bash
chmod +x daily-token-counter.sh token-history-logger.sh
```

### OpenClaw CLI Not Found
Make sure you're running from a shell where `openclaw` is in PATH:
```bash
which openclaw
```

## Contributing

Found a bug or want to improve it? PRs welcome!

## License

MIT ‚Äî Use freely, modify as needed.

---

**Made for OpenClaw personal assistants.** Zero dependencies, pure bash, eternally free. üêï
